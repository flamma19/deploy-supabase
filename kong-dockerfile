FROM kong:2.8.1

LABEL maintainer="your-email@example.com"


ENV KONG_DATABASE="off" \
    KONG_DECLARATIVE_CONFIG="/home/kong/kong.yml" \
    KONG_DNS_ORDER="LAST,A,CNAME" \
    KONG_PLUGINS="request-transformer,cors,key-auth,acl,basic-auth" \
    KONG_NGINX_PROXY_PROXY_BUFFER_SIZE="160k" \
    KONG_NGINX_PROXY_PROXY_BUFFERS="64 160k"

ENV SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJhbm9uIiwKICAgICJpc3MiOiAic3VwYWJhc2UtZGVtbyIsCiAgICAiaWF0IjogMTY0MTc2OTIwMCwKICAgICJleHAiOiAxNzk5NTM1NjAwCn0.dc_X5iR_VP_qT0zsiyj_I_OZ2T9FtRU2BBNWN8Bu4GE" \
    SUPABASE_SERVICE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJzZXJ2aWNlX3JvbGUiLAogICAgImlzcyI6ICJzdXBhYmFzZS1kZW1vIiwKICAgICJpYXQiOiAxNjQxNzY5MjAwLAogICAgImV4cCI6IDE3OTk1MzU2MDAKfQ.DaYlNEoUrrEn2Ig7tqibS-PHK5vgusbcbo7X36XVt4Q" \
    DASHBOARD_USERNAME="supabase" \
    DASHBOARD_PASSWORD="this_password_is_insecure_and_should_be_updated"

EXPOSE 8000/tcp 8443/tcp

COPY ./volumes/api/kong.yml /home/kong/temp.yml

ENTRYPOINT ["bash", "-c", "eval \"echo \\\"$(cat /home/kong/temp.yml)\\\"\" > /home/kong/kong.yml && /docker-entrypoint.sh kong docker-start"]

CMD ["kong", "docker-start"]