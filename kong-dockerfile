FROM kong:2.8.1

LABEL maintainer="your-email@example.com"


ENV KONG_DATABASE="off" \
    KONG_DECLARATIVE_CONFIG="/home/kong/kong.yml" \
    KONG_DNS_ORDER="LAST,A,CNAME" \
    KONG_PLUGINS="request-transformer,cors,key-auth,acl,basic-auth" \
    KONG_NGINX_PROXY_PROXY_BUFFER_SIZE="160k" \
    KONG_NGINX_PROXY_PROXY_BUFFERS="64 160k"

ENV SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1jYmd0Z3ptZGdpdXN5bGx0aXh6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTgxOTUxMzEsImV4cCI6MjAzMzc3MTEzMX0.U2jZ6rXmXuaXwramicZWFNRHvIMitcoKuF8sdls5a-s" \
    SUPABASE_SERVICE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1jYmd0Z3ptZGdpdXN5bGx0aXh6Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTcxODE5NTEzMSwiZXhwIjoyMDMzNzcxMTMxfQ.zuOrkNkDDmO0V15E3G71Y1AUN8Bs0dutP1r7E2RVkb0" \
    DASHBOARD_USERNAME="supabase" \
    DASHBOARD_PASSWORD="this_password_is_insecure_and_should_be_updated"

EXPOSE 8000/tcp 8443/tcp

COPY ./volumes/api/kong.yml /home/kong/temp.yml

ENTRYPOINT ["bash", "-c", "eval \"echo \\\"$(cat /home/kong/temp.yml)\\\"\" > /home/kong/kong.yml && /docker-entrypoint.sh kong docker-start"]

CMD ["kong", "docker-start"]